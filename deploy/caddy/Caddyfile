rays-games.loseyourip.com {
	route {
		# API -> Node (strip /api)
		handle_path /api/* {
			reverse_proxy 127.0.0.1:3000
		}

		# WebSocket upgrades -> Node
		@ws {
			path /ws*
			header Connection *Upgrade*
			header Upgrade websocket
		}
		handle @ws {
			reverse_proxy 127.0.0.1:3000 {
				transport http {
					versions 1.1
				}
			}
		}

		# Canonical legal URLs (avoid SPA fallback swallowing non-slash paths)
		redir /terms /terms/ 308
		redir /privacy /privacy/ 308

		# Frontend (everything else)
		handle {
			root * /var/www/rays-games
			try_files {path} {path}/index.html /index.html
			file_server
		}

	}
}
